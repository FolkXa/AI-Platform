(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[55],{37126:(e,a,t)=>{Promise.resolve().then(t.bind(t,90991))},90991:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>er});var s=t(99436),i=t(5657),r=t(87118),n=t(2806),l=t(18170),o=t(13449),c=t.n(o),d=t(7313),m=t(55422),x=t(28103),u=t(86964),h=t(17967),p=t(34590),g=t(16062),y=t(29704),f=t(45893);function j(e){let{uploadState:a,dataPreview:t,onFileChange:r,onDragEnter:n,onDragLeave:l,onDragOver:o,onDrop:c,isValidFileType:d,formatFileSize:m}=e;return(0,s.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,s.jsxs)(u.Zp,{className:"bg-gray-900/50 border-gray-800",children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsx)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},children:(0,s.jsxs)(u.ZB,{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.P.div,{animate:{y:[0,-5,0]},transition:{duration:2,repeat:1/0,repeatDelay:2},children:(0,s.jsx)(p.A,{className:"h-5 w-5 text-green-400"})}),(0,s.jsx)("span",{children:"Upload Your Data"})]})}),(0,s.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.5},children:(0,s.jsx)(u.BT,{children:"Upload CSV or Excel files to start chatting with your data"})})]}),(0,s.jsxs)(u.Wu,{children:[(0,s.jsxs)(i.P.div,{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(a.dragActive?"border-green-500 bg-green-500/10":"border-gray-700 hover:border-gray-600"),onDragEnter:n,onDragLeave:l,onDragOver:o,onDrop:c,whileHover:{scale:1.02},whileTap:{scale:.98},animate:{scale:a.dragActive?1.05:1,borderColor:a.dragActive?"#10b981":"#374151"},transition:{duration:.2},children:[(0,s.jsx)(i.P.div,{animate:{rotate:a.dragActive?[0,10,-10,0]:0,scale:a.dragActive?1.1:1},transition:{duration:.3},children:(0,s.jsx)(g.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"})}),(0,s.jsx)(i.P.p,{className:"text-gray-300 mb-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},children:"Drag and drop your data file here, or click to browse"}),(0,s.jsx)(i.P.p,{className:"text-sm text-gray-500 mb-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.5},children:"Supports CSV, XLS, and XLSX files up to 50MB"}),(0,s.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{if(e.target.files&&e.target.files[0]){let a=e.target.files[0];d(a)&&r(a)}},className:"hidden",id:"data-upload",disabled:a.uploading}),(0,s.jsx)(i.P.label,{htmlFor:"data-upload",className:"inline-block cursor-pointer px-4 py-2 rounded-md font-medium transition-colors focus:outline-none border border-gray-300 text-white hover:text-gray-700 hover:bg-gray-50 bg-transparent",whileHover:{scale:1.05},whileTap:{scale:.95},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1,duration:.5},children:a.uploading?"Processing...":"Choose File"})]}),(0,s.jsxs)(x.N,{children:[a.uploading&&(0,s.jsx)(i.P.div,{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",initial:{opacity:0,y:-20,scale:.8},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.8},transition:{duration:.3},children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.P.div,{className:"rounded-full h-4 w-4 border-b-2 border-blue-400",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),(0,s.jsx)("span",{className:"text-blue-400 text-sm",children:"Processing your file..."})]})}),a.error&&(0,s.jsx)(i.P.div,{className:"mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",initial:{opacity:0,y:-20,scale:.8},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-20,scale:.8},transition:{duration:.3},children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.P.div,{animate:{rotate:[0,-10,10,0]},transition:{duration:.5,repeat:2},children:(0,s.jsx)(y.A,{className:"h-4 w-4 text-red-400"})}),(0,s.jsx)("span",{className:"text-red-400 text-sm",children:a.error})]})}),a.file&&!a.uploading&&(0,s.jsxs)(i.P.div,{className:"mt-4 p-4 bg-gray-800/50 rounded-lg",initial:{opacity:0,y:20,scale:.8},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.8},transition:{duration:.3},children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(i.P.div,{animate:{rotate:[0,5,-5,0]},transition:{duration:1,repeat:1/0,repeatDelay:3},children:(0,s.jsx)(g.A,{className:"h-5 w-5 text-green-400"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:a.file.name}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:m(a.file.size)})]}),t&&(0,s.jsx)(i.P.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:10},children:(0,s.jsx)(f.A,{className:"h-5 w-5 text-green-400"})})]}),(null==t?void 0:t.chatSession)&&(0,s.jsx)(i.P.div,{className:"mt-2 pt-2 border-t border-gray-700",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2,duration:.3},children:(0,s.jsx)(h.E,{variant:"outline",className:"text-xs text-green-400 border-green-400",children:"Chat Session Active"})})]})]})]})]})})}var v=t(19298),b=t(86272);function N(e){let{dataPreview:a,formatFileSize:t}=e;return(0,s.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,s.jsxs)(u.Zp,{className:"bg-gray-900/50 border-gray-800",children:[(0,s.jsx)(u.aR,{children:(0,s.jsx)(i.P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},children:(0,s.jsxs)(u.ZB,{className:"flex items-center space-x-2",children:[(0,s.jsx)(i.P.div,{animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:(0,s.jsx)(v.A,{className:"h-5 w-5 text-green-400"})}),(0,s.jsx)("span",{children:"Data Overview"})]})})}),(0,s.jsx)(u.Wu,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"File:"}),(0,s.jsx)("span",{className:"font-medium text-sm truncate ml-2",children:a.fileName})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Size:"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:t(a.fileSize)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Rows:"}),(0,s.jsx)(h.E,{variant:"secondary",children:a.rows.toLocaleString()})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Columns:"}),(0,s.jsx)(h.E,{variant:"secondary",children:a.columns})]})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Column Headers:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:a.headers.map((e,a)=>(0,s.jsx)(h.E,{variant:"outline",className:"text-xs",children:e},a))})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Sample Data:"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-xs",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"border-b border-gray-700",children:a.headers.slice(0,4).map((e,a)=>(0,s.jsx)("th",{className:"text-left p-2 text-gray-400",children:e},a))})}),(0,s.jsx)("tbody",{children:a.sampleData.map((e,a)=>(0,s.jsx)("tr",{className:"border-b border-gray-800",children:e.slice(0,4).map((e,a)=>(0,s.jsx)("td",{className:"p-2 text-gray-300",children:e},a))},a))})]})})]}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("h4",{className:"font-medium mb-2 flex items-center",children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2 text-green-400"}),"AI Insights:"]}),(0,s.jsx)("ul",{className:"space-y-1",children:a.insights.map((e,a)=>(0,s.jsxs)("li",{className:"text-sm text-gray-300 flex items-start",children:[(0,s.jsx)("div",{className:"h-1.5 w-1.5 bg-green-400 rounded-full mt-2 mr-3 flex-shrink-0"}),e]},a))})]})]})})]})})}var w=t(64416),S=t(81693);let C=w.forwardRef((e,a)=>{let{className:t,type:i,...r}=e;return(0,s.jsx)("input",{type:i,className:(0,S.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r})});C.displayName="Input";var P=t(58695),A=t(58817),k=t(80174),T=t(25748),D=t(83822),I=t(93285),F=t(68252),E=t(73782),L=t(54188);function O(e){let{content:a,className:t=""}=e;return(0,s.jsx)("div",{className:"prose prose-invert max-w-none ".concat(t),children:(0,s.jsx)(I.oz,{remarkPlugins:[F.A],components:{code(e){let{className:a,children:t,...i}=e,r=/language-(\w+)/.exec(a||"");return r&&r?(0,s.jsx)(E.A,{style:L.A,language:r[1],PreTag:"div",className:"rounded-md",children:String(t).replace(/\n$/,"")}):(0,s.jsx)("code",{className:"bg-gray-800 px-1.5 py-0.5 rounded text-sm font-mono",...i,children:t})},table(e){let{children:a}=e;return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)("table",{className:"min-w-full divide-y divide-gray-700 border border-gray-700 rounded-lg",children:a})})},th(e){let{children:a}=e;return(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase tracking-wider bg-gray-800 border-b border-gray-700",children:a})},td(e){let{children:a}=e;return(0,s.jsx)("td",{className:"px-3 py-2 text-sm text-gray-300 border-b border-gray-800",children:a})},blockquote(e){let{children:a}=e;return(0,s.jsx)("blockquote",{className:"border-l-4 border-green-500 pl-4 py-2 my-4 bg-green-500/10 rounded-r-lg",children:a})},ul(e){let{children:a}=e;return(0,s.jsx)("ul",{className:"list-disc list-inside space-y-1 my-4",children:a})},ol(e){let{children:a}=e;return(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-1 my-4",children:a})},a(e){let{children:a,href:t}=e;return(0,s.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"text-green-400 hover:text-green-300 underline",children:a})},h1(e){let{children:a}=e;return(0,s.jsx)("h1",{className:"text-xl font-bold text-white mt-6 mb-4",children:a})},h2(e){let{children:a}=e;return(0,s.jsx)("h2",{className:"text-lg font-semibold text-white mt-5 mb-3",children:a})},h3(e){let{children:a}=e;return(0,s.jsx)("h3",{className:"text-base font-medium text-white mt-4 mb-2",children:a})},p(e){let{children:a}=e;return(0,s.jsx)("p",{className:"text-gray-300 leading-relaxed mb-3",children:a})},strong(e){let{children:a}=e;return(0,s.jsx)("strong",{className:"font-semibold text-white",children:a})},em(e){let{children:a}=e;return(0,s.jsx)("em",{className:"italic text-gray-200",children:a})}},children:a})})}var _=t(99070);let M={closed:{opacity:0},open:{opacity:1}};function R(e){let{isOpen:a,onClose:t,children:r}=e;return(0,s.jsx)(_.bL,{open:a,onOpenChange:t,children:(0,s.jsx)(x.N,{children:a&&(0,s.jsxs)(_.ZL,{forceMount:!0,children:[(0,s.jsx)(_.hJ,{asChild:!0,children:(0,s.jsx)(i.P.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",initial:"closed",animate:"open",exit:"closed",variants:M})}),(0,s.jsx)(_.UC,{className:"fixed inset-4 bg-gray-900/90 border border-gray-800 rounded-lg shadow-xl z-50 flex flex-col",children:(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:r})})]})})})}let z=(0,w.memo)(()=>(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse delay-75"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse delay-150"})]}));z.displayName="LoadingDots";let U=(0,w.memo)(e=>{var a;let{dataPreview:t,sampleQuestions:i,onQuestionClick:n}=e,l=(null==t?void 0:t.sampleQuestions)&&(null==t?void 0:null===(a=t.sampleQuestions)||void 0===a?void 0:a.length)>0?null==t?void 0:t.sampleQuestions:i;return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Try asking:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,s.jsx)(r.$,{variant:"outline",size:"sm",className:"text-xs text-left h-auto py-1 px-2 bg-transparent break-words whitespace-normal hover:scale-105 transition-transform duration-200",onClick:()=>n(e),children:e},e))})]})});U.displayName="SampleQuestions";let B=(0,w.memo)(e=>{let{message:a,isNew:t=!1}=e;return(0,s.jsxs)(i.P.div,{initial:!!t&&{opacity:0,x:"user"===a.role?50:-50,y:20},animate:{opacity:1,x:0,y:0},transition:{duration:.4,type:"spring",stiffness:100,damping:15},className:"p-3 rounded-lg ".concat("user"===a.role?"bg-green-600/20 ml-8":"bg-gray-800/50 mr-8"),children:["user"===a.role?(0,s.jsx)("p",{className:"text-sm",children:a.content}):(0,s.jsx)(O,{content:a.content,className:"text-sm"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.timestamp).toLocaleTimeString()})]},a.id)});B.displayName="ChatMessage";let V=(0,w.memo)(e=>{let{messages:a,isLoading:t,isFullScreen:r,messagesContainerRef:n}=e;return(0,s.jsxs)("div",{ref:n,className:"space-y-4 overflow-y-auto ".concat(r?"flex-1 min-h-0":"max-h-96"),style:r?{height:"100%"}:void 0,children:[0===a.length&&(0,s.jsx)("div",{className:"text-center py-4",children:(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Start a conversation about your data"})}),a.map((e,t)=>(0,s.jsx)(B,{message:e,isNew:t===a.length-1},e.id)),t&&(0,s.jsxs)(i.P.div,{className:"flex items-center space-x-2 p-3 bg-gray-800/50 rounded-lg mr-8",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},children:[(0,s.jsx)(z,{}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"AI is typing..."})]})]})});V.displayName="ChatMessages";let W=(0,w.memo)(e=>{let{input:a,isLoading:t,onInputChange:i,onSubmit:n}=e;return(0,s.jsxs)("form",{onSubmit:n,className:"flex space-x-2",children:[(0,s.jsx)(C,{value:a,onChange:i,placeholder:"Ask about your data... e.g., 'What's the total revenue?'",className:"flex-1 bg-gray-800 border-gray-700 focus:scale-[1.02] transition-transform duration-200",disabled:t}),(0,s.jsx)(r.$,{type:"submit",disabled:t||!a.trim(),className:"bg-green-600 hover:bg-green-700 hover:scale-105 transition-transform duration-200",children:t?(0,s.jsx)(P.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(A.A,{className:"h-4 w-4"})})]})});W.displayName="ChatInput";let Q=(0,w.memo)(e=>{let{isFullScreen:a,dataPreview:t,chatState:i,sampleQuestions:n,handleQuestionClick:o,onInputChange:c,onSubmit:d,handleToggleFullScreen:m,messagesContainerRef:x}=e;return(0,s.jsxs)(u.Zp,{className:"bg-gray-900/50 border-gray-800 h-full flex flex-col",children:[(0,s.jsxs)(u.aR,{className:"flex-shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(u.ZB,{className:"flex items-center space-x-2",children:[(0,s.jsx)(k.A,{className:"h-5 w-5 text-green-400"}),(0,s.jsx)("span",{children:"Chat with Your Data"})]}),(0,s.jsx)(r.$,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-white hover:scale-110 transition-transform duration-200",onClick:m,children:a?(0,s.jsx)(T.A,{className:"h-4 w-4"}):(0,s.jsx)(D.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(u.BT,{children:(null==t?void 0:t.chatSession)?"Ask questions about your CSV data in natural language":"Upload a CSV file to enable interactive chat functionality"})]}),(0,s.jsx)(u.Wu,{className:a?"flex-1 overflow-hidden flex flex-col min-h-0":"",children:t?t.chatSession?(0,s.jsxs)("div",{className:"space-y-4 ".concat(a?"flex-1 flex flex-col min-h-0":""),children:[(0,s.jsx)(U,{dataPreview:t,sampleQuestions:n,onQuestionClick:o}),(0,s.jsx)(V,{messages:i.messages,isLoading:i.isLoading,isFullScreen:a,messagesContainerRef:x}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(W,{input:i.input,isLoading:i.isLoading,onInputChange:c,onSubmit:d})})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(g.A,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Chat functionality is available for CSV files only"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Upload a CSV file to enable interactive chat"})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(l.A,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Upload a data file to start chatting"})]})})]})});Q.displayName="ChatContent";let X=(0,w.memo)(function(e){let{chatState:a,dataPreview:t,onInputChange:r,onSubmit:n,sampleQuestions:l}=e,[o,c]=(0,w.useState)(!1),d=(0,w.useRef)(null),m=(0,w.useCallback)(()=>{d.current&&(d.current.scrollTop=d.current.scrollTop=d.current.scrollHeight)},[]);(0,w.useEffect)(()=>{m()},[a.messages.length,m]);let x=(0,w.useCallback)(()=>{c(e=>!e)},[]),u=(0,w.useCallback)(e=>{r({target:{value:e}})},[r]);return(0,s.jsx)(s.Fragment,{children:o?(0,s.jsx)(R,{isOpen:o,onClose:x,children:(0,s.jsx)("div",{className:"h-full flex flex-col",children:(0,s.jsx)(Q,{isFullScreen:!0,dataPreview:t,chatState:a,sampleQuestions:l,handleQuestionClick:u,onInputChange:r,onSubmit:n,handleToggleFullScreen:x,messagesContainerRef:d})})}):(0,s.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,s.jsx)(Q,{isFullScreen:!1,dataPreview:t,chatState:a,sampleQuestions:l,handleQuestionClick:u,onInputChange:r,onSubmit:n,handleToggleFullScreen:x,messagesContainerRef:d})})})}),Z=t(65453).A.create({baseURL:"http://localhost:8000/api/v1",timeout:12e4,headers:{"Content-Type":"application/json"}});Z.interceptors.request.use(async e=>{let a=localStorage.getItem("token");return console.log("token: ",a),a&&(e.headers.Authorization="Bearer ".concat(a)),e},e=>(console.error("Request error:",e),Promise.reject(e))),Z.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401?window.location.href="/auth/signin":console.error("Response error:",e),Promise.reject(e)});let q={analyzeData:async e=>{let a=new FormData;return a.append("file",e),(await Z.post("/analysis-upload-file",a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{let a=Math.round(100*e.loaded/(e.total||1));console.log("Upload Progress: ".concat(a,"%"))}})).data},createChatSession:async e=>{let a=new FormData;a.append("file",e);let t=await Z.post("/ollama-chat/create-session",a,{headers:{"Content-Type":"multipart/form-data"}});return{sessionId:t.data.session_id,fileName:t.data.file_name,createdAt:t.data.created_at,lastUpdated:t.data.last_updated}},sendStreamingMessage:async(e,a,t,s)=>{var i;let r=new FormData;r.append("session_id",e),r.append("message",a),r.append("file",t);let n=await fetch("".concat(Z.defaults.baseURL,"/ollama-chat/send-streaming-message"),{method:"POST",body:r});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let l=null===(i=n.body)||void 0===i?void 0:i.getReader();if(!l)throw Error("No response body reader available");let o=new TextDecoder,c="";for(;;){let{done:e,value:a}=await l.read();if(e)break;c+=o.decode(a,{stream:!0});let t=0,i=-1,r=[];for(let e=0;e<c.length;e++)if("{"===c[e])0===t&&(i=e),t++;else if("}"===c[e]&&0==--t&&-1!==i){let a=c.substring(i,e+1);r.push(a),i=-1}for(let e of r)try{let a=e.replace(/'/g,'"').replace(/True/g,"true").replace(/False/g,"false"),t=JSON.parse(a);t.message&&t.message.content&&!t.done&&s(t.message.content)}catch(a){console.warn("Failed to parse object chunk:",e,a)}c=-1!==i?c.substring(i):""}},getSessionMessages:async e=>(await Z.get("/ollama-chat/session/".concat(e,"/messages"))).data.map(e=>({id:e.id,content:e.content,role:e.role,timestamp:e.timestamp,fileName:e.file_name}))},H=0,$=new Map,J=e=>{if($.has(e))return;let a=setTimeout(()=>{$.delete(e),ee({type:"REMOVE_TOAST",toastId:e})},1e6);$.set(e,a)},Y=(e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?J(t):e.toasts.forEach(e=>{J(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}},G=[],K={toasts:[]};function ee(e){K=Y(K,e),G.forEach(e=>{e(K)})}function ea(e){let{...a}=e,t=(H=(H+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>ee({type:"DISMISS_TOAST",toastId:t});return ee({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>ee({type:"UPDATE_TOAST",toast:{...e,id:t}})}}let et=e=>["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)||e.name.endsWith(".csv")||e.name.endsWith(".xlsx")||e.name.endsWith(".xls"),es=e=>{if(0===e)return"0 Bytes";let a=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]},ei=["What's the total sales for January?","Which product category performs best?","Show me revenue trends by region","What's the average order value?","Which customers buy the most?","Create a summary table of the data","Show me the data structure and types"];function er(){let{chatState:e,uploadState:a,dataPreview:t,isValidFileType:o,formatFileSize:x,handleFileChange:u,handleDrag:h,handleDrop:p,handleInputChange:g,handleSubmit:y}=function(){let[e,a]=(0,w.useState)({messages:[],input:"",isLoading:!1,sessionId:null}),[t,s]=(0,w.useState)({file:null,uploading:!1,error:null,dragActive:!1}),[i,r]=(0,w.useState)(null),n=(0,w.useCallback)(async e=>{s(e=>({...e,uploading:!0,error:null})),r(null),a({messages:[],input:"",isLoading:!1,sessionId:null});try{let t;let s=await q.analyzeData(e);if(e.name.endsWith(".csv"))try{let s=await q.createChatSession(e);t=s,a(e=>({...e,sessionId:s.sessionId})),ea({title:"Chat session created!",description:"You can now ask questions about your CSV data"})}catch(e){console.warn("Failed to create chat session:",e),ea({title:"Chat session creation failed",description:"File analysis completed, but chat functionality may be limited",variant:"destructive"})}r({...s,chatSession:t}),ea({title:"File uploaded successfully!",description:"Analyzed ".concat(s.rows.toLocaleString()," rows of data").concat(t?" and created chat session":"")})}catch(a){var t,i;let e=(null===(i=a.response)||void 0===i?void 0:null===(t=i.data)||void 0===t?void 0:t.error)||"Failed to process file";s(a=>({...a,error:e})),ea({title:"Upload failed",description:e,variant:"destructive"})}finally{s(e=>({...e,uploading:!1}))}},[]),l=(0,w.useCallback)(e=>{s(a=>({...a,file:e})),n(e)},[n]),o=(0,w.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?s(e=>({...e,dragActive:!0})):"dragleave"===e.type&&s(e=>({...e,dragActive:!1}))},[]),c=(0,w.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),s(e=>({...e,dragActive:!1})),e.dataTransfer.files&&e.dataTransfer.files[0]){let a=e.dataTransfer.files[0];et(a)?l(a):s(e=>({...e,error:"Please upload a CSV, XLS, or XLSX file"}))}},[l]),d=(0,w.useCallback)(e=>{a(a=>({...a,input:e.target.value}))},[]),m=(0,w.useCallback)(async s=>{if(s.preventDefault(),!e.input.trim()||!t.file||!e.sessionId)return;let i=e.input.trim(),r={id:Date.now().toString(),content:i,role:"user",timestamp:new Date().toISOString(),fileName:t.file.name};a(e=>({...e,messages:[...e.messages,r],input:"",isLoading:!0}));let n=(Date.now()+1).toString(),l={id:n,content:"",role:"assistant",timestamp:new Date().toISOString(),fileName:t.file.name};a(e=>({...e,messages:[...e.messages,l]}));try{await q.sendStreamingMessage(e.sessionId,i,t.file,e=>{a(a=>({...a,messages:a.messages.map(a=>a.id===n?{...a,content:a.content+e}:a)}))}),a(e=>({...e,isLoading:!1}))}catch(t){var o,c;let e=(null===(c=t.response)||void 0===c?void 0:null===(o=c.data)||void 0===o?void 0:o.error)||"Failed to send message";a(a=>({...a,messages:a.messages.map(a=>a.id===n?{...a,content:"Error: ".concat(e)}:a),isLoading:!1})),ea({title:"Chat error",description:e,variant:"destructive"})}},[e.input,e.sessionId,t.file]),x=(0,w.useCallback)(async e=>{try{let t=await q.getSessionMessages(e);a(e=>({...e,messages:t}))}catch(e){console.warn("Failed to load chat history:",e)}},[]);return(0,w.useEffect)(()=>{e.sessionId&&x(e.sessionId)},[e.sessionId,x]),{chatState:e,uploadState:t,dataPreview:i,isValidFileType:et,formatFileSize:es,handleFileChange:l,handleDrag:o,handleDrop:c,handleInputChange:d,handleSubmit:m}}();return(0,s.jsx)(d.O,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white",children:[(0,s.jsx)("header",{className:"border-b border-gray-800 bg-gray-900/50 backdrop-blur-sm",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.P.div,{className:"flex items-center space-x-4",initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},children:[(0,s.jsx)(i.P.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,s.jsx)(c(),{href:"/",children:(0,s.jsxs)(r.$,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:[(0,s.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Back to Platform"]})})}),(0,s.jsxs)(i.P.div,{className:"flex items-center space-x-2",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.4,duration:.5},children:[(0,s.jsx)(i.P.div,{className:"h-8 w-8 bg-green-500/20 text-green-400 rounded-lg flex items-center justify-center",animate:{rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:(0,s.jsx)(l.A,{className:"h-4 w-4"})}),(0,s.jsx)("h1",{className:"text-xl font-bold",children:"Chat with My Data"})]})]}),(0,s.jsx)(i.P.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},transition:{delay:.6,duration:.5},children:(0,s.jsx)(m.p,{})})]})})}),(0,s.jsx)(i.P.div,{className:"container mx-auto px-4 py-8",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3,duration:.5},children:(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,s.jsxs)(i.P.div,{className:"space-y-6",initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{delay:.5,duration:.6},children:[(0,s.jsx)(j,{uploadState:a,dataPreview:t,onFileChange:u,onDragEnter:h,onDragLeave:h,onDragOver:h,onDrop:p,isValidFileType:o,formatFileSize:x}),t&&(0,s.jsx)(N,{dataPreview:t,formatFileSize:x})]}),(0,s.jsx)(i.P.div,{className:"space-y-6",initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{delay:.7,duration:.6},children:(0,s.jsx)(X,{chatState:e,dataPreview:t,onInputChange:g,onSubmit:y,sampleQuestions:ei})})]})})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[653,391,11,331,476,844,610,607,358],()=>a(37126)),_N_E=e.O()}]);